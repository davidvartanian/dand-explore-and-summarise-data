# Red Wine Exploration
### by David Vartanian

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(ggplot2)
library(gridExtra)
library(dplyr)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
data <- read.csv("data/wineQualityReds.csv")
```

# Abstract
I describe a dataset with almost 1600 types of red wine, in order to understand
the meaning of the assigned score.

# Introduction
This dataset is provided by Paulo Cortez, António Cerdeira, Fernando Almeida,
Telmo Matos, and José Reis, from different universities in Portugal. It provides
information like acidity, residual sugar, chlorides, and alcohol among others.
I explore the data to find patterns and trends and get the meaning of the given
fetures. More information [here](http://www.sciencedirect.com/science/article/pii/S0167923609001377?via%3Dihub).


# Univariate Plots Section
Let's start showing some summary numbers and first histograms to understand
individual variables.

```{r echo=FALSE, Summary}
summary(data)
```

### Histograms: quality, fixed.acidity, total.sulfur.dioxide, alcohol
```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots}
plot.volatile.acidity <- ggplot(aes(x = volatile.acidity), data = data) +
  geom_histogram(aes(colour = I('#CC9933'))) +
  xlab('Volatile Acidity')

plot.fixed.acidity <- ggplot(aes(x = fixed.acidity), data = data) +
  geom_histogram(aes(colour = I('#99CCFF'))) +
  xlab('Fixed Acidity')

plot.total.sulfur.dioxide <- ggplot(aes(x = total.sulfur.dioxide), data = data) +
  geom_histogram(aes(colour = I('#00DD99'))) +
  xlab('Total Sulphure Dioxide')

plot.alcohol <- ggplot(aes(x = alcohol), data = data) +
  geom_histogram(aes(colour = I('#FF3366'))) +
  xlab('Alcohol %')

plot.chlorides <- ggplot(aes(x = chlorides), data = data) +
  geom_histogram(aes(colour = I('#CCFF00'))) +
  xlab('Chlorides')

plot.residual.sugar <- ggplot(aes(x = residual.sugar), data = data) +
  geom_histogram(aes(colour = I('#6688CC'))) +
  xlab('Residual Sugar')

plot.pH <- ggplot(aes(x = pH), data = data) +
  geom_histogram(aes(colour = I('#CC00CC'))) +
  xlab('pH')

plot.sulphates <- ggplot(aes(x = sulphates), data = data) +
  geom_histogram(aes(colour = I('#33DDDD'))) +
  xlab('Sulphates')

plot.density <- ggplot(aes(x = density), data = data) +
  geom_histogram(aes(colour = I('#91C0F9'))) +
  xlab('Density')

grid.arrange(plot.volatile.acidity, plot.fixed.acidity, plot.total.sulfur.dioxide, plot.alcohol, 
             plot.chlorides, plot.residual.sugar, plot.pH, plot.sulphates, plot.density, ncol = 3)
```

These histograms show the distribution of values in the different variables.

# Univariate Analysis

### Dataset Structure
There are 9 continuous variables, 2 discrete variables and one categorical
variable: quality.

### Main dataset interest
My general question is, how chemical properties define the quality of the red 
wine?

There are interesting features in this dataset, each of them describing an
important property of the red wine. Density, pH, sulphur dioxide, and sulphates
are, in my opinion, the most important ones, in order to measure the quality.
Let's see what can we find looking at those variables.

#### pH
This variable indicates the acidity level of the wine.
The scale goes from 0 (very acid) to 14 (very basic). But most of red wines are
between 3 and 4.

```{r echo=FALSE, pH}
ggplot(aes(x = pH), data = data) +
  facet_wrap(~quality) +
  geom_histogram(binwidth = 0.01, aes(colour = quality)) +
  labs(x = 'pH', title = 'pH faceted by Quality')
```

It's quite surprising that levels of pH are lower on low-quality and 
high-quality wines.

#### Density of water
The level of this variable depends on alcohol percentage and sugar.

```{r echo=FALSE, Density_vs_Quality_Faceted}
plot.density.quality.faceted <- ggplot(aes(x = density), data = data) +
  facet_wrap(~quality) +
  geom_histogram(binwidth = 0.001, aes(colour = quality)) +
  labs(x = 'Density', title = 'Density faceted by Quality')
plot.density.quality.faceted
```

Density levels are also lower on low-quality and high-quality wines.

#### Free Sulphure Dioxide
The free form of SO2 exists in equilibrium between molecular SO2 (as a dissolved 
gas) and bisulfite ion. It prevents microbial growth and the oxidation of the 
wine.

```{r echo=FALSE, Free_Sulphur_dioxide}
ggplot(aes(x = free.sulfur.dioxide), data = data) +
  facet_wrap(~quality) +
  geom_histogram(binwidth = 3, aes(colour = quality)) +
  labs(x = 'Free Sulphure Dioxide', title = 'Free Sulphure Dioxide faceted by Quality')
```

Again, the levels for this variable are lower for low-quality and high-quality
wines.

#### Sulphates
Additive contributing with sulphure dioxide gas (S02) levels, acting as an 
antimicrobial and antioxidant.

```{r echo=FALSE, Sulphur_dioxide}
ggplot(aes(x = sulphates), data = data) +
  facet_wrap(~quality) +
  geom_histogram(binwidth = 0.1, aes(colour = quality)) +
  labs(x = 'Sulphates', title = 'Sulphates faceted by Quality')
```

Sulphates levels are lower for low-quality and high-quality wines as well.

### Variable Transformations
It was not necessary to clean missing values on this dataset. However, I think 
it is a good idea to apply some transformations to skewed variables.

```{r echo=FALSE, message=FALSE, warning=FALSE, Transforming_Variables1}
# create categorical variable: durability
data$durability <- ifelse(data$sulphates > median(data$sulphates) 
                          & data$free.sulfur.dioxide > median(data$free.sulfur.dioxide), 
                          c("L"), c("S"))
plot.volatile.acidity + scale_x_log10() + ggtitle('Volatile Acidity - Log10')
```

Transformed Volatile Acidity using log base 10.

```{r echo=FALSE, message=FALSE, warning=FALSE, Transforming_Variables2}
plot.fixed.acidity + scale_x_log10() + ggtitle('Fixed Acidity - Log10')
```

Transformed Fixed Acidity using log base 10.

```{r echo=FALSE, message=FALSE, warning=FALSE, Transforming_Variables3}
plot.total.sulfur.dioxide + scale_x_log10() + ggtitle('Total Sulphure Dioxide - Log10')
```

Transformed Total Sulphure Dioxide using log base 10.

```{r echo=FALSE, message=FALSE, warning=FALSE, Transforming_Variables4}
plot.chlorides + scale_x_log10() + ggtitle('Chlorides - Log10')
```

Transformed Chlorides using log base 10.

```{r echo=FALSE, message=FALSE, warning=FALSE, Transforming_Variables5}
plot.residual.sugar + scale_x_log10() + ggtitle('Residual Sugar - Log10')
```

Transformed Residual Sugar using log base 10.

```{r echo=FALSE, message=FALSE, warning=FALSE, Transforming_Variables6}
plot.sulphates + scale_x_log10() + ggtitle('Sulphates - Log10')
```

Transformed Sulphates using log base 10.

```{r echo=FALSE, message=FALSE, warning=FALSE, Transforming_Variables7}
ggplot(aes(x = free.sulfur.dioxide), data = data) +
  geom_histogram(aes(colour = I('#00DD99'))) +
  xlab('Free Sulphure Dioxide') +
  ggtitle('Free Sulphure Dioxide - Log10') +
  scale_x_log10()
```

Transformed Free Sulphure Dioxide using log base 10.

# Bivariate Plots Section
Let's try to find trends, and interesting patterns by comparing two variables.

```{r echo=FALSE, message=FALSE, warning=FALSE, Quality_Distribution_Alcohol}
ggplot(aes(x = alcohol, y = quality), data = data) +
  geom_smooth(aes(colour = quality), method = 'loess') +
  ggtitle('Quality vs. Level of alcohol') +
  xlab('Alcohol %') +
  ylab('Quality')
```

> **Fact**: Higher quality wines seem to have higher levels of alcohol

```{r echo=FALSE, message=FALSE, warning=FALSE, Quality_Distribution_FixedAcidity}
ggplot(aes(x = fixed.acidity, y = quality), data = data) +
  geom_smooth(aes(colour = quality), method = 'loess') +
  ggtitle('Quality vs. Level of fixed acidity') +
  xlab('Fixed Acidity') +
  ylab('Quality')
```

> **Fact**: Higher quality wines seem to have lower levels of acidity

```{r echo=FALSE, message=FALSE, warning=FALSE, Quality_vs_Density}
ggplot(aes(x = density, y = quality), data = data) +
  geom_smooth(aes(colour = quality), method = 'loess') +
  ggtitle('Density vs. Quality') +
  xlab('Density') +
  ylab('Quality')
```

> **Fact**: Higher quality wines seem to have lower density

```{r echo=FALSE, Bivariate_Plots1}
plot.citric_acid_pH <- ggplot(aes(x = citric.acid, y = pH), data = data) +
  geom_point(aes(colour = I('#8DB7A4'), alpha = 1/10)) +
  xlab('Citric Acid') +
  ggtitle('Citric Acid vs. pH')
plot.citric_acid_pH
```

Citric Acid adds freshness flavor to the wine.

```{r echo=FALSE, Bivariate_Plots2}
ggplot(aes(x = volatile.acidity, y = pH), data = data) +
  geom_point(aes(colour = I('#B19784'), alpha = 1/10)) +
  xlab('Volatile Acidity') +
  ggtitle('Volatile Acidity vs. pH')
```

Level of acetic acid. Too high levels make an unpleasant vinegar taste.

```{r echo=FALSE, Bivariate_Plots3}
ggplot(aes(x = density, y = quality), data = data) +
  geom_point(aes(colour = quality, alpha = 1/10), position = 'jitter') +
  xlab('Density') +
  ylab('Quality') +
  ggtitle('Density vs. Quality')
```

# Bivariate Analysis

### Relationships

```{r echo=FALSE, Density_vs_Quality}
ggplot(aes(x = density, y = quality), data = data) +
  geom_point(aes(colour = density, alpha = 1/10), position = 'jitter') +
  labs(x = 'Density', y = 'Quality', title = 'Density vs. Quality')
```

```{r echo=FALSE, Chlorides_vs_Sulphates}
ggplot(aes(x = chlorides, y = sulphates), data = data) +
  geom_point(aes(colour = sulphates, alpha = 1/20)) +
  labs(x = 'Chlorides', y = 'Sulphates', title = 'Chlorides vs. Sulphates')
```

```{r echo=FALSE, Residual_Sugar_vs_Chlorides}
ggplot(aes(x = chlorides, y = residual.sugar), data = data) +
  geom_point(aes(colour = residual.sugar, alpha = 1/10)) +
  labs(x = 'Chlorides', y = 'Residual Sugar', title = 'Chlorides vs. Residual Sugar')
```

```{r echo=FALSE, Free_Sulphure_Dioxide_vs_Total_Sulphure_Dioxide}
ggplot(aes(x = total.sulfur.dioxide, y = free.sulfur.dioxide), data = data) +
  geom_point(aes(colour = free.sulfur.dioxide, alpha = 1/10)) +
  labs(x = 'Total Sulphure Dioxide', y = 'Free Sulphure Dioxide', title = 'Free vs. Total Sulphure Dioxide')

score.sulfur.dioxide <- (log10(data$free.sulfur.dioxide) + log10(data$total.sulfur.dioxide)) / 2
```

### Interesting relationships

#### Density vs Quality
I've found a slightly positive correlation, meaning that *density* tends to be
lower on high-quality wines. However, this correlation is not so important to 
determine the quality.

#### Chlorides vs Sulphates
I've found that levels are mostly low for both variables. I would say that they 
don't influence much on the quality as all types of wine have the same level of 
these two variables.

#### Chlorides vs Residual Sugar
I've found the same here, as they keep levels constantly low.

#### Free vs. Total Sulphure Dioxide
Levels keep always low. However these two variables seem to be correlated.

# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots1}
plot.durability.quality_alcohol <- ggplot(aes(x = quality, y = alcohol), data=data) +
  geom_line(aes(colour = durability), stat = 'summary', fun.y = median) +
  labs(x = 'Quality', y = 'Alcohol', title = 'Durability regarding Alcohol vs. Quality')
plot.durability.quality_alcohol
```

Level of durability regarding alcohol and quality.

```{r echo=FALSE, Multivariate_Plots2}
ggplot(aes(x=density, y=alcohol),
       data=data)+
  geom_smooth(aes(color=durability), method = 'loess') +
  labs(x = 'Density', y = 'Alcohol', title = 'Durability regarding Density vs. Alcohol')
```

Level of durability regarding alcohol and density.

# Multivariate Analysis

```{r echo=FALSE, Summarise_By_Quality}
winesByQuality <- data %>%
  group_by(quality) %>%
  summarise(mean_quality = mean(quality),
            mean_alcohol = mean(alcohol),
            mean_density = mean(density),
            mean_ph = mean(pH),
            mean_citric_acid = mean(citric.acid),
            n = n())
summary(winesByQuality)
```

### Density & pH
A pretty strong correlation can be observed between these two variables, 
regarding the quality of wines. Meaning that it's normal to find lower levels 
of pH and density on high-quality wines.

### Durability
Using the new variable *durability* it's possible to appreciate that 
high-quality wines with high graduation of alcohol are more likely to last in 
good conditions due to the effect of *sulphates* and *free sulphure dioxide*.

------

# Final Plots and Summary

### Durability & Alcohol
```{r echo=FALSE, Plot_One}
plot.durability.quality_alcohol
```

Something very remarkable to keep in mind is what this plot shows: high-quality
wines seem to last more time. But the orange line on the top-right corner makes
a huge difference. They last much longer when alcohol level is higher.

### Citric Acid vs. pH
```{r echo=FALSE, Plot_Two}
plot.citric_acid_pH
```

This is a pretty straight forward correlation. When pH level gets lower (which
means that there is more acid) citric acid gets higher. It makes sense, right?

### Density by Quality Level
```{r echo=FALSE, Plot_Three}
plot.density.quality.faceted
```

I wanted to emphasize this plot again because levels of density look similar for
both low-quality and high-quality wines. Or from another perspective, the 
density of water is higher only on mid-quality wines.

------

# Reflection
I feel that now I have a few extra tips to select new wines to taste. Higher 
levels of alcohol and acidity, lower levels of density, as well as low levels of 
residual sugar, chlorides, and sulphates. High levels of alcohol and low level 
of density were definitely surprising for me.
However, I think that the data set needs some more categorical variables and 
much more data to make a better analysis.

